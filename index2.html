<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>10" Portable Rack UI (2.5G + 10G ready)</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#09090b;
      --panel:#111113;
      --panel2:#0a0a0c;
      --border:#1e1e22;
      --muted:#777;
      --muted2:#555;
      --text:#e0e0e0;
      --white:#fff;

      --c-power:#d35400;
      --c-network:#2471a3;
      --c-compute:#1e8449;
      --c-storage:#8e44ad;
      --c-accessory:#7d3c98;
      --c-external:#2c2c33;

      --v10:#2ecc71;
      --v20:#3498db;
      --v30:#e74c3c;

      --shadow: 0 10px 25px rgba(0,0,0,.35);
      --radius: 10px;
    }

    *{ box-sizing:border-box; margin:0; padding:0; }
    html,body{ height:100%; }
    body{
      font-family: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      background: var(--bg);
      color: var(--text);
      padding: 20px 24px;
    }

    ::-webkit-scrollbar{ width: 6px; height: 6px; }
    ::-webkit-scrollbar-track{ background: transparent; }
    ::-webkit-scrollbar-thumb{ background: #333; border-radius: 3px; }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.55} }

    .container{ max-width: 1120px; margin: 0 auto; }
    .header{
      margin-bottom: 16px;
    }
    .titleRow{
      display:flex; align-items: baseline; gap: 12px; margin-bottom: 6px;
    }
    h1{
      font-family: "Space Grotesk", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      font-size: 26px; font-weight: 700; color: var(--white); letter-spacing: -0.5px;
    }
    .badge{
      font-size: 11px; color: #444; font-weight: 600;
      background: #1a1a1e; padding: 3px 8px; border-radius: 6px;
      border: 1px solid var(--c-network);
      display:inline-flex; gap:8px; align-items:center;
    }
    .badgeDot{
      width:7px; height:7px; border-radius: 3px; background: var(--c-network);
      animation: pulse 1.8s infinite;
    }
    .gradLine{
      height: 2px;
      background: linear-gradient(90deg, var(--c-network) 0%, var(--c-compute) 50%, var(--c-power) 100%);
      border-radius: 2px; opacity: .75;
      margin-bottom: 12px;
    }
    .metaRow{
      display:flex; gap: 24px; font-size: 11px; color: #666; flex-wrap: wrap;
    }
    .metaRow strong{ color:#ccc; font-weight:700; }
    .metaAccent{ color: var(--c-power) !important; }
    .metaGood{ color: var(--c-compute) !important; }
    .metaNet{ color: var(--c-network) !important; }

    .tabs{
      display:flex; gap: 6px;
      margin-bottom: 16px;
    }
    .tabBtn{
      font-family: inherit;
      font-size: 11px;
      color: #666;
      background: transparent;
      border: 1px solid transparent;
      padding: 7px 14px;
      border-radius: 8px;
      cursor:pointer;
      transition: all .15s;
    }
    .tabBtn:hover{ color:#aaa; }
    .tabBtn.active{
      color: #fff;
      background: #1a1a1e;
      border-color: #333;
      box-shadow: 0 0 0 1px rgba(255,255,255,.02) inset;
    }

    .grid{
      display:grid;
      grid-template-columns: 340px 1fr;
      gap: 18px;
      align-items: start;
    }

    .panel{
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }
    .panelInner{ padding: 14px; }

    .rackTopNote{
      font-size: 9px; color:#444; text-align:center;
      text-transform: uppercase; letter-spacing: 2px;
      margin-bottom: 10px;
    }

    .rackFrame{
      background: var(--panel2);
      border: 2px solid #161618;
      border-radius: 8px;
      padding: 8px 7px;
      display:flex;
      flex-direction: column;
      gap: 3px;
    }

    .slot{
      position: relative;
      border-radius: 7px;
      border: 1px solid var(--border);
      background: linear-gradient(180deg, #17171a 0%, #131315 100%);
      cursor: pointer;
      padding: 0 10px;
      display:flex;
      align-items: center;
      gap: 10px;
      overflow:hidden;
      transition: all .15s;
      user-select:none;
    }
    .slot:hover{
      border-color:#2c2c33;
      transform: translateY(-1px);
    }
    .slot.selected{
      transform: translateY(-1px);
      box-shadow: 0 0 0 1px rgba(255,255,255,.03) inset;
    }

    .slotBar{
      position:absolute; left:0; top:0; bottom:0;
      width: 4px;
      opacity: .35;
    }
    .slot.selected .slotBar{ opacity: 1; }

    .slotU{
      font-size: 9px;
      color: #444;
      width: 34px;
      flex: 0 0 auto;
    }
    .slotName{
      font-size: 11px;
      color: #888;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
      flex: 1 1 auto;
    }
    .slot.selected .slotName{ color:#fff; font-weight: 700; }
    .slotTag{
      font-size: 8px;
      color: #d35400;
      font-weight: 800;
      letter-spacing: .5px;
      margin-right: 4px;
    }
    .slotWatts{
      font-size: 9px;
      color:#555;
      flex: 0 0 auto;
    }

    .legend{
      display:flex;
      gap: 10px;
      justify-content:center;
      flex-wrap: wrap;
      margin-top: 12px;
      padding-bottom: 4px;
    }
    .legendItem{
      display:flex; align-items:center; gap:6px;
      font-size: 9px; color:#555;
    }
    .swatch{ width: 8px; height: 8px; border-radius: 3px; }

    .extBlock{ margin-top: 14px; }
    .extTitle{
      font-size: 9px; color:#444; text-align:center;
      text-transform: uppercase; letter-spacing: 1.5px;
      margin-bottom: 6px;
    }
    .extRow{
      border: 1px dashed #282830;
      background: #131315;
      border-radius: 8px;
      height: 34px;
      padding: 0 10px;
      display:flex; align-items:center;
      cursor:pointer;
      transition: all .15s;
    }
    .extRow:hover{ border-color:#3a3a44; }
    .extRow.selected{ border-style: solid; }

    /* Detail */
    .detail{
      padding: 18px 18px;
      border-radius: var(--radius);
      animation: fadeIn .2s ease;
    }
    .detailHeader{
      display:flex; align-items: center; gap: 10px;
      margin-bottom: 14px;
    }
    .iconBox{
      width: 38px; height: 38px;
      border-radius: 10px;
      display:flex; align-items:center; justify-content:center;
      font-size: 18px;
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.03);
    }
    h2{
      font-family: "Space Grotesk", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      font-size: 18px;
      font-weight: 700;
      color: var(--white);
      line-height: 1.15;
    }
    .detailSub{
      font-size: 10px;
      color:#666;
      margin-top: 2px;
    }
    .desc{
      font-size: 12px;
      color:#bbb;
      line-height: 1.65;
      margin-bottom: 14px;
    }
    .callout{
      background: var(--panel2);
      border: 1px solid #1a1a1e;
      border-radius: 10px;
      padding: 14px;
      margin-bottom: 14px;
    }
    .calloutTitle{
      font-size: 9px;
      color:#555;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 8px;
    }
    .calloutBody{
      font-size: 11px;
      color:#888;
      line-height: 1.7;
    }
    .changed{
      background: #1a1508;
      border: 1px solid rgba(211,84,0,.2);
    }
    .changed .calloutTitle{ color: var(--c-power); }
    .changed .calloutBody{ color: #b8860b; }

    .kvGrid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 6px;
      margin-top: 10px;
    }
    .kv{
      display:flex;
      justify-content: space-between;
      font-size: 11px;
      color:#999;
    }
    .kv small{ color:#666; }
    .kv strong{ color:#fff; font-weight: 700; }
    .kvLine{
      border-top: 1px solid #1e1e22;
      padding-top: 6px;
      margin-top: 2px;
      font-size: 12px;
    }

    .hintEmpty{
      min-height: 320px;
      display:flex;
      flex-direction: column;
      align-items:center;
      justify-content:center;
      gap: 12px;
      text-align:center;
      padding: 24px;
    }
    .hintArrow{
      font-size: 30px;
      opacity: .18;
    }
    .hintText{
      font-size: 12px;
      color:#444;
      max-width: 280px;
      line-height: 1.6;
    }

    /* VLAN + Ports */
    .cards3{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 14px;
      margin-bottom: 16px;
    }
    .vCard{
      padding: 16px;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: var(--panel);
      box-shadow: var(--shadow);
    }
    .vTop{
      display:flex; align-items:center; gap: 8px;
      margin-bottom: 10px;
    }
    .vDot{ width: 10px; height: 10px; border-radius: 4px; }
    .vTitle{
      font-family: "Space Grotesk", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      font-size: 15px;
      font-weight: 700;
      color: var(--white);
    }
    .vName{ font-size: 13px; color:#ccc; margin-bottom: 4px; }
    .vDesc{ font-size: 11px; color:#777; margin-bottom: 8px; line-height: 1.45; }
    .vNet{ font-size: 10px; font-weight: 700; }

    .policy{
      padding: 18px;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: var(--panel);
      box-shadow: var(--shadow);
      margin-bottom: 16px;
    }
    .policy h3, .ports h3, .changes h3{
      font-family: "Space Grotesk", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      font-size: 14px;
      font-weight: 700;
      color: var(--white);
      margin-bottom: 12px;
    }
    .policyGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      font-size: 11px;
    }
    .rule{
      display:flex; align-items:center; gap: 8px;
      padding: 8px 12px;
      background: var(--panel2);
      border: 1px solid #1a1a1e;
      border-radius: 10px;
    }
    .rule span:first-child{ color:#999; flex:1; }
    .rule b{ font-size: 10px; letter-spacing: .5px; }

    .ports{
      padding: 18px;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: var(--panel);
      box-shadow: var(--shadow);
    }
    .portsGrid{
      display:grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 8px;
      font-size: 10px;
    }
    .port{
      background: var(--panel2);
      border: 1px solid #1a1a1e;
      border-radius: 10px;
      padding: 10px 8px;
      text-align:center;
      cursor:pointer;
      transition: all .15s;
      user-select:none;
    }
    .port:hover{ transform: translateY(-1px); border-color:#2c2c33; }
    .port .pNum{ font-weight: 900; color:#ccc; margin-bottom: 4px; }
    .port .pDev{ font-size: 9px; color:#777; margin-bottom: 3px; line-height: 1.3; }
    .port .pVlan{ font-size: 9px; font-weight: 800; }

    .changes{
      padding: 18px;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: var(--panel);
      box-shadow: var(--shadow);
    }
    .changeNote{
      font-size: 12px;
      color:#888;
      line-height: 1.6;
      margin-bottom: 14px;
    }
    .changeRow{
      background: var(--panel2);
      border: 1px solid #1a1a1e;
      border-radius: 12px;
      padding: 14px;
      margin-bottom: 10px;
    }
    .changeCols{
      display:flex;
      gap: 14px;
      margin-bottom: 10px;
      font-size: 11px;
    }
    .col{ flex:1; }
    .label{
      font-size: 9px;
      color:#666;
      text-transform: uppercase;
      margin-bottom: 4px;
      letter-spacing: 1px;
    }
    .before{ color: var(--v30); text-decoration: line-through; opacity: .7; }
    .after{ color: var(--v10); font-weight: 800; }
    .impact{ text-align:right; }
    .impactVal{ color: var(--c-compute); font-weight: 900; font-size: 12px; }
    .why{ font-size: 11px; color:#777; line-height: 1.6; }

    .footerHint{
      margin-top: 12px;
      font-size: 10px;
      color:#555;
      line-height: 1.6;
    }

    /* Responsive */
    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
      .cards3{ grid-template-columns: 1fr; }
      .portsGrid{ grid-template-columns: repeat(3, 1fr); }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <div class="titleRow">
        <h1>10" PORTABLE RACK</h1>
        <div class="badge" title="Designed for 2.5G access + 10G expansion headroom">
          <span class="badgeDot"></span>
          2.5G ACCESS + 10G READY
        </div>
      </div>

      <div class="gradLine"></div>

      <div class="metaRow" id="metaRow">
        <!-- populated by JS -->
      </div>
    </div>

    <div class="tabs" role="tablist" aria-label="Sections">
      <button class="tabBtn active" data-tab="rack" role="tab">Rack Layout</button>
      <button class="tabBtn" data-tab="vlans" role="tab">VLAN Design</button>
      <button class="tabBtn" data-tab="ports" role="tab">Ports</button>
      <button class="tabBtn" data-tab="changes" role="tab">Notes</button>
    </div>

    <!-- RACK TAB -->
    <section id="tab-rack">
      <div class="grid">
        <!-- Rack column -->
        <div class="panel">
          <div class="panelInner">
            <div class="rackTopNote">Front View ‚Äî click any slot</div>
            <div class="rackFrame" id="rackFrame"></div>

            <div class="extBlock" id="externalBlock">
              <div class="extTitle">External</div>
              <div id="externalList"></div>
            </div>

            <div class="legend" id="legend"></div>
          </div>
        </div>

        <!-- Details column -->
        <div class="panel" id="detailPanel">
          <div class="detail hintEmpty" id="detailEmpty">
            <div class="hintArrow">‚Üê</div>
            <div class="hintText">Click any slot in the rack to see specs, wiring intent, and why it‚Äôs there.</div>
          </div>

          <div class="detail" id="detailView" style="display:none"></div>
        </div>
      </div>
    </section>

    <!-- VLAN TAB -->
    <section id="tab-vlans" style="display:none">
      <div class="cards3" id="vlanCards"></div>

      <div class="policy">
        <h3>Inter-VLAN Firewall Policy (high-level)</h3>
        <div class="policyGrid" id="policyGrid"></div>
        <div class="footerHint">
          Stateful rules assumed on your router/firewall (e.g., RB5009 or pfSense/OPNsense).
          IoT cannot initiate new connections to Trusted/Servers; it can only respond to established flows.
        </div>
      </div>
    </section>

    <!-- PORTS TAB -->
    <section id="tab-ports" style="display:none">
      <div class="ports">
        <h3>Switch Port Allocation (CRS310-8G+2S+IN)</h3>
        <div class="portsGrid" id="portsGrid"></div>
        <div class="footerHint">
          Click a port tile to see details in the right panel (same detail panel as rack items).
        </div>
      </div>
    </section>

    <!-- NOTES TAB -->
    <section id="tab-changes" style="display:none">
      <div class="changes">
        <h3>Build Notes (2 Proxmox + TrueNAS + DAS + Pi strip)</h3>
        <div class="changeNote">
          This layout targets a 10-inch rack, 2.5G everywhere by default, with optional 10G uplift (SFP+ uplinks, NAS, or workstation).
          The rack representation is ‚Äúfront-slot UI‚Äù, not a literal mechanical drawing.
        </div>

        <div class="changeRow">
          <div class="changeCols">
            <div class="col">
              <div class="label">Network tier</div>
              <div class="after">2.5G access ports + 10G SFP+ headroom</div>
            </div>
            <div class="col impact">
              <div class="label">Intent</div>
              <div class="impactVal">Fast LAN without overkill</div>
            </div>
          </div>
          <div class="why">
            CRS310 gives you 8√ó2.5G for every device in the rack and 2√óSFP+ for future 10G links (NAS, workstation, uplink).
          </div>
        </div>

        <div class="changeRow">
          <div class="changeCols">
            <div class="col">
              <div class="label">Compute tier</div>
              <div class="after">2√ó Proxmox nodes + 1√ó TrueNAS SCALE</div>
            </div>
            <div class="col impact">
              <div class="label">Intent</div>
              <div class="impactVal">Simple HA + storage</div>
            </div>
          </div>
          <div class="why">
            Two-node Proxmox for clustering/migration, TrueNAS for ZFS + shares, and a 6-bay DAS shelf at the bottom for dense storage in 10-inch width.
          </div>
        </div>

        <div class="changeRow">
          <div class="changeCols">
            <div class="col">
              <div class="label">SBC strip</div>
              <div class="after">4√ó Raspberry Pi horizontally in one 1U slot</div>
            </div>
            <div class="col impact">
              <div class="label">Intent</div>
              <div class="impactVal">Always-on utilities</div>
            </div>
          </div>
          <div class="why">
            Keeps ‚Äúinfrastructure glue‚Äù separate from Proxmox: DNS, controllers, monitoring, small automations. Survives node reboots.
          </div>
        </div>

        <div class="footerHint">
          To ‚Äúadd pages‚Äù: keep this file as <b>index.html</b> and duplicate it as <b>rack.html</b>, <b>network.html</b>, etc.
          The data objects at the top of the script can be edited per page.
        </div>
      </div>
    </section>
  </div>

  <script>
    // ========= DATA =========
    const CATEGORIES = {
      power:    { label: "Power",    color: getCSS("--c-power"),   icon: "‚ö°" },
      network:  { label: "Networking",color: getCSS("--c-network"), icon: "üåê" },
      compute:  { label: "Compute",  color: getCSS("--c-compute"), icon: "üñ•Ô∏è" },
      storage:  { label: "Storage",  color: getCSS("--c-storage"), icon: "üóÑÔ∏è" },
      accessory:{ label: "Accessory",color: getCSS("--c-accessory"),icon: "üîß" },
    };

    // VLANs are "design intent"; adjust to your real subnets if needed.
    const VLANS = [
      { id: 10, name: "Trusted / Personal", subnet: "10.0.10.0/24", color: getCSS("--v10"), desc: "Laptops, phones, admin clients" },
      { id: 20, name: "Servers / Lab",      subnet: "10.0.20.0/24", color: getCSS("--v20"), desc: "Proxmox, NAS, services" },
      { id: 30, name: "IoT / Untrusted",    subnet: "10.0.30.0/24", color: getCSS("--v30"), desc: "IoT, guest SSIDs, cameras" },
    ];

    // Rack items (order = top-to-bottom).
    // U sizing is UI-only. Keep total around 12U-ish for a compact rack.
    const RACK_ITEMS = [
      {
        u: "0.5U", uNum: 0.5,
        name: "DC PDU Lite 7-CH",
        category: "power",
        brand: "DeskPi / GeeekPi",
        price: 35, watts: 2,
        description: "0.5U rack-mount DC distribution with switched outputs.",
        notes: "One quality DC brick into the PDU; short DC jumpers to each device. Minimizes wall-wart clutter and keeps the rack serviceable."
      },
      {
        u: "0.5U", uNum: 0.5,
        name: "12-Port CAT6 Patch Panel",
        category: "network",
        brand: "DeskPi / GeeekPi",
        price: 18, watts: 0,
        description: "0.5U keystone patch panel for clean front cabling.",
        notes: "Terminate fixed cables at the rear; use short patch leads on the front. You stop touching the back wiring once it‚Äôs dressed."
      },
      {
        u: "1U", uNum: 1,
        name: "CRS310-8G+2S+IN",
        category: "network",
        brand: "MikroTik",
        price: 160, watts: 34,
        description: "8√ó2.5G RJ45 + 2√óSFP+ (1G/2.5G/10G capable). RouterOS v7.",
        notes: "2.5G everywhere now; SFP+ gives 10G uplift later (NAS/workstation/uplink). Ideal 10-inch rack backbone."
      },
      {
        u: "1U", uNum: 1,
        name: "RB5009UG+S+IN (Router/Firewall)",
        category: "network",
        brand: "MikroTik",
        price: 220, watts: 15,
        description: "RouterOS v7 routing + firewall. 2.5G WAN/LAN capable with SFP+ headroom.",
        notes: "Handles VLAN routing, firewall policy, DHCP, DNS, and VPN. Pair with CRS310 for a compact, serious core."
      },
      {
        u: "0.5U", uNum: 0.5,
        name: "Brush Cable Manager",
        category: "accessory",
        brand: "DeskPi / GeeekPi",
        price: 10, watts: 0,
        description: "Cable pass-through and visual separator between tiers.",
        notes: "Keeps the ‚Äònetwork tier‚Äô and ‚Äòcompute tier‚Äô tidy. Small part; big impact on cable flow."
      },

      // --- Compute tier ---
      {
        u: "1U", uNum: 1,
        name: "Proxmox Node 1 (ThinkCentre / Mini PC)",
        category: "compute",
        brand: "Lenovo / Similar",
        price: 0, watts: 18,
        description: "Primary Proxmox node (2.5G NIC preferred).",
        notes: "Run your containers/VMs here. If it has dual NICs, one can be mgmt, one can be VM trunk ‚Äî or just trunk VLANs on a single NIC."
      },
      {
        u: "1U", uNum: 1,
        name: "Proxmox Node 2 (ThinkCentre / Mini PC)",
        category: "compute",
        brand: "Lenovo / Similar",
        price: 0, watts: 18,
        description: "Secondary Proxmox node for a 2-node cluster.",
        notes: "Gives you migration/maintenance flexibility. Add a small 3rd witness (qdevice) later if you want cleaner quorum behavior."
      },
      {
        u: "1U", uNum: 1,
        name: "TrueNAS SCALE (Compact Host)",
        category: "storage",
        brand: "Custom / Mini PC",
        price: 0, watts: 25,
        description: "ZFS + shares + backups. 2.5G default; 10G optional via SFP+/adapter.",
        notes: "Use for NFS/SMB to Proxmox, snapshots, and backups. If you ever want 10G, this is the first place it matters."
      },

      // 4x Pi strip in one slot
      {
        u: "1U", uNum: 1,
        name: "SBC Strip (4√ó Raspberry Pi)",
        category: "compute",
        brand: "Raspberry Pi",
        price: 0, watts: 20,
        description: "Four Raspberry Pis mounted horizontally as a 1U ‚Äòstrip‚Äô.",
        notes: "Great for always-on infrastructure glue: DNS, controller(s), monitoring, small automations, build agents. Keeps essentials up during Proxmox maintenance.",
        extras: [
          { name: "Pi #1 (DNS/AdGuard)", price: 0 },
          { name: "Pi #2 (Controller/UniFi)", price: 0 },
          { name: "Pi #3 (Monitoring/Grafana)", price: 0 },
          { name: "Pi #4 (Automation/n8n-lite)", price: 0 },
        ]
      },

      // workstation + misc
      {
        u: "1U", uNum: 1,
        name: "Micro / Workstation (Rack Shelf)",
        category: "compute",
        brand: "Any",
        price: 0, watts: 35,
        description: "Optional ‚Äòin-rack‚Äô micro PC or a docked laptop/mini workstation.",
        notes: "Useful as a console box, ingestion machine, or a local build runner. If you want 10G in the future, this is another good endpoint."
      },

      // DAS at bottom
      {
        u: "3U", uNum: 3,
        name: "TGC 5-Bay 3.5" SATA/SAS Hot-Swappable HDD Enclosure (10-inch width target)",
        category: "storage",
        brand: "Custom enclosure / Shelf",
        price: 229, watts: 55,
        description: "Bottom-mounted 5-bay DAS target (10-inch rack fit).",
        notes: "If 5 bays fits your 10-inch chassis width: keep the drives at the bottom for stability and airflow. Consider front-to-back airflow and a single hot-swap plane if you want easy servicing.",
        extras: [
          { name: "Bay 1", price: 0 },
          { name: "Bay 2", price: 0 },
          { name: "Bay 3", price: 0 },
          { name: "Bay 4", price: 0 },
          { name: "Bay 5", price: 0 },
        ]
      },

      // External AP example
      {
        u: "0", uNum: 0,
        name: "Wi-Fi AP (external)",
        category: "network",
        brand: "Ubiquiti / Other",
        price: 0, watts: 15,
        description: "External AP carrying VLAN SSIDs (trunked).",
        notes: "Mount outside the rack. Trunk VLANs from the router/switch. Map SSIDs to VLAN 10/20/30 as required.",
        external: true
      }
    ];

    // Ports are shown in the Ports tab and also selectable (like rack items).
    const SWITCH_PORTS = [
      { port: "1",   device: "RB5009 ‚Üî CRS310 (Trunk)", vlan: "Trunk (10/20/30)", color: "#fff",      refName: "CRS310-8G+2S+IN" },
      { port: "2",   device: "Proxmox Node 1",         vlan: "VLAN 20",          color: getCSS("--v20"), refName: "Proxmox Node 1 (ThinkCentre / Mini PC)" },
      { port: "3",   device: "Proxmox Node 2",         vlan: "VLAN 20",          color: getCSS("--v20"), refName: "Proxmox Node 2 (ThinkCentre / Mini PC)" },
      { port: "4",   device: "TrueNAS SCALE",          vlan: "VLAN 20",          color: getCSS("--v20"), refName: "TrueNAS SCALE (Compact Host)" },
      { port: "5",   device: "SBC Strip (Pi uplink)",  vlan: "VLAN 20",          color: getCSS("--v20"), refName: "SBC Strip (4√ó Raspberry Pi)" },
      { port: "6",   device: "Workstation/Micro",      vlan: "VLAN 10",          color: getCSS("--v10"), refName: "Micro / Workstation (Rack Shelf)" },
      { port: "7",   device: "Spare / IoT bridge",     vlan: "VLAN 30",          color: getCSS("--v30"), refName: "CRS310-8G+2S+IN" },
      { port: "8",   device: "Spare",                  vlan: "--",               color: "#555",       refName: "CRS310-8G+2S+IN" },
      { port: "SFP+ 1", device: "Future 10G NAS link", vlan: "VLAN 20 (10G)",     color: "#999",       refName: "TrueNAS SCALE (Compact Host)" },
      { port: "SFP+ 2", device: "Future 10G uplink",   vlan: "Trunk/Uplink",     color: "#999",       refName: "CRS310-8G+2S+IN" },
    ];

    const POLICY_RULES = [
      { from: "Trusted (10)", to: "Servers (20)", action: "ALLOW", color: getCSS("--v10") },
      { from: "Trusted (10)", to: "IoT (30)",     action: "ALLOW", color: getCSS("--v10") },
      { from: "Trusted (10)", to: "Internet",     action: "ALLOW", color: getCSS("--v10") },
      { from: "Servers (20)", to: "Internet",     action: "ALLOW", color: getCSS("--v10") },
      { from: "Servers (20)", to: "IoT (30)",     action: "ALLOW", color: getCSS("--v10") },
      { from: "Servers (20)", to: "Trusted (10)", action: "DROP",  color: getCSS("--v30") },
      { from: "IoT (30)",     to: "Internet",     action: "ALLOW", color: getCSS("--v10") },
      { from: "IoT (30)",     to: "Everything else", action: "DROP", color: getCSS("--v30") },
    ];

    // ========= STATE =========
    let selectedId = null;          // can be a rack item index or a synthetic port ID
    let activeTab = "rack";

    // ========= INIT =========
    init();

    function init(){
      wireTabs();
      renderMeta();
      renderRack();
      renderLegend();
      renderVlans();
      renderPolicy();
      renderPorts();
      // default: no selection
      showDetail(null);
    }

    // ========= RENDERERS =========
    function renderMeta(){
      const rackItems = RACK_ITEMS.filter(i => !i.external);
      const totalU = round1(rackItems.reduce((s,i)=>s+i.uNum,0));
      const watts = RACK_ITEMS.filter(i=>!i.external).reduce((s,i)=>s+(i.watts||0),0);

      const cost = RACK_ITEMS.reduce((s,i)=>{
        const base = i.price || 0;
        const extras = (i.extras||[]).reduce((es,e)=>es+(e.price||0),0);
        return s + base + extras;
      },0);

      const meta = document.getElementById("metaRow");
      meta.innerHTML = `
        <span>RACK <strong>${totalU}U / 12U</strong></span>
        <span>POWER <strong class="metaAccent">~${watts}W</strong></span>
        <span>COST <strong class="metaGood">~$${formatInt(cost)} AUD</strong></span>
        <span>VLANs <strong class="metaNet">3 subnets + WAN</strong></span>
        <span>ACCESS <strong>2.5 Gbps</strong></span>
        <span>HEADROOM <strong>10G via SFP+</strong></span>
      `;
    }

    function renderRack(){
      const rackFrame = document.getElementById("rackFrame");
      rackFrame.innerHTML = "";

      const rackItems = RACK_ITEMS.filter(i => !i.external);
      rackItems.forEach((item) => {
        const idx = RACK_ITEMS.indexOf(item);
        const cat = CATEGORIES[item.category];
        const height = Math.max(item.uNum * 44, 28);

        const slot = document.createElement("div");
        slot.className = "slot";
        slot.style.height = `${height}px`;
        slot.dataset.id = `rack:${idx}`;

        if (isSelected(`rack:${idx}`)) slot.classList.add("selected");

        // selected styling tint
        if (isSelected(`rack:${idx}`)){
          slot.style.borderColor = hexA(cat.color, 0.45);
          slot.style.background = hexA(cat.color, 0.10);
        }

        slot.innerHTML = `
          <div class="slotBar" style="background:${cat.color}"></div>
          <div class="slotU">${item.u}</div>
          <div class="slotName" title="${escapeHtml(item.name)}">${escapeHtml(item.name)}</div>
          ${item.changed ? `<div class="slotTag">NEW</div>` : ``}
          ${(item.watts||0) > 0 ? `<div class="slotWatts">${item.watts}W</div>` : `<div class="slotWatts"></div>`}
        `;

        slot.addEventListener("click", () => select(`rack:${idx}`));
        rackFrame.appendChild(slot);
      });

      // External list
      const externalList = document.getElementById("externalList");
      const externalItems = RACK_ITEMS.filter(i => i.external);
      externalList.innerHTML = "";
      externalItems.forEach((item) => {
        const idx = RACK_ITEMS.indexOf(item);
        const cat = CATEGORIES[item.category];

        const row = document.createElement("div");
        row.className = "extRow";
        row.dataset.id = `rack:${idx}`;
        if (isSelected(`rack:${idx}`)) {
          row.classList.add("selected");
          row.style.borderColor = cat.color;
          row.style.background = hexA(cat.color, 0.10);
        }

        row.innerHTML = `
          <div style="flex:1; font-size:11px; color:#777;">${escapeHtml(item.name)}</div>
          <div style="font-size:9px; color:#555;">${item.watts||0}W</div>
        `;
        row.addEventListener("click", ()=> select(`rack:${idx}`));
        externalList.appendChild(row);
      });
    }

    function renderLegend(){
      const legend = document.getElementById("legend");
      legend.innerHTML = "";
      Object.entries(CATEGORIES).forEach(([k,v])=>{
        const el = document.createElement("div");
        el.className = "legendItem";
        el.innerHTML = `<span class="swatch" style="background:${v.color}"></span>${v.label}`;
        legend.appendChild(el);
      });
    }

    function renderVlans(){
      const wrap = document.getElementById("vlanCards");
      wrap.innerHTML = "";
      VLANS.forEach(v=>{
        const card = document.createElement("div");
        card.className = "vCard";
        card.style.borderColor = hexA(v.color, 0.35);
        card.innerHTML = `
          <div class="vTop">
            <div class="vDot" style="background:${v.color}"></div>
            <div class="vTitle">VLAN ${v.id}</div>
          </div>
          <div class="vName">${escapeHtml(v.name)}</div>
          <div class="vDesc">${escapeHtml(v.desc)}</div>
          <div class="vNet" style="color:${v.color}">${escapeHtml(v.subnet)}</div>
          <div style="font-size:10px; color:#555; margin-top:6px">Gateway: ${escapeHtml(v.subnet.replace(".0/24",".1"))}</div>
          <div style="font-size:10px; color:#555">DHCP pool: .100‚Äì.200</div>
        `;
        wrap.appendChild(card);
      });
    }

    function renderPolicy(){
      const grid = document.getElementById("policyGrid");
      grid.innerHTML = "";
      POLICY_RULES.forEach(r=>{
        const row = document.createElement("div");
        row.className = "rule";
        row.innerHTML = `
          <span>${escapeHtml(r.from)} ‚Üí ${escapeHtml(r.to)}</span>
          <b style="color:${r.color}">${escapeHtml(r.action)}</b>
        `;
        grid.appendChild(row);
      });
    }

    function renderPorts(){
      const grid = document.getElementById("portsGrid");
      grid.innerHTML = "";

      SWITCH_PORTS.forEach((p, i)=>{
        const el = document.createElement("div");
        el.className = "port";
        const id = `port:${i}`;
        el.dataset.id = id;

        el.innerHTML = `
          <div class="pNum">Port ${escapeHtml(p.port)}</div>
          <div class="pDev">${escapeHtml(p.device)}</div>
          <div class="pVlan" style="color:${p.color}">${escapeHtml(p.vlan)}</div>
        `;
        el.addEventListener("click", ()=>{
          select(id);
          // jump user to rack tab feel? keep in place, just show detail.
          // (Detail panel is shared; works in any tab)
        });
        grid.appendChild(el);
      });
    }

    // ========= DETAIL =========
    function showDetail(selectionId){
      const empty = document.getElementById("detailEmpty");
      const view = document.getElementById("detailView");

      if (!selectionId){
        empty.style.display = "flex";
        view.style.display = "none";
        view.innerHTML = "";
        return;
      }

      const detail = resolveDetail(selectionId);
      if (!detail){
        empty.style.display = "flex";
        view.style.display = "none";
        view.innerHTML = "";
        return;
      }

      empty.style.display = "none";
      view.style.display = "block";

      const cat = CATEGORIES[detail.category] || { label:"", color:"#444", icon:"‚Ä¢" };

      view.style.border = `1px solid ${hexA(cat.color, 0.25)}`;
      view.innerHTML = `
        <div class="detailHeader">
          <div class="iconBox" style="border-color:${hexA(cat.color,0.35)}; background:${hexA(cat.color,0.10)}">${cat.icon}</div>
          <div>
            <h2>${escapeHtml(detail.name)}</h2>
            <div class="detailSub">
              ${escapeHtml(detail.brand || "‚Äî")} | ${escapeHtml(detail.uLabel || detail.u || "External")} | ${(detail.watts||0)}W |
              <span style="color:${cat.color}; font-weight:800">${escapeHtml(cat.label)}</span>
            </div>
          </div>
        </div>

        <div class="desc">${escapeHtml(detail.description || "")}</div>

        <div class="callout">
          <div class="calloutTitle">Why it‚Äôs here</div>
          <div class="calloutBody">${escapeHtml(detail.notes || "")}</div>
        </div>

        ${detail.changed ? `
          <div class="callout changed">
            <div class="calloutTitle">Note</div>
            <div class="calloutBody">${escapeHtml(detail.changeNote || "Updated choice / revised layout note.")}</div>
          </div>
        ` : ""}

        ${detail.extras && detail.extras.length ? `
          <div class="callout">
            <div class="calloutTitle">Sub-components / Bays</div>
            <div class="calloutBody">
              ${detail.extras.map(e=>`‚Ä¢ ${escapeHtml(e.name)}`).join("<br/>")}
            </div>
          </div>
        ` : ""}

        <div class="callout">
          <div class="calloutTitle">Budget + Power (placeholders allowed)</div>
          <div class="kvGrid">
            <div class="kv"><span>Base unit</span><strong>~$${formatInt(detail.price||0)} AUD</strong></div>
            ${(detail.extras||[]).map(e=>`
              <div class="kv" style="padding-left:12px; font-size:10px; color:#666;">
                <span>+ ${escapeHtml(e.name)}</span><small>~$${formatInt(e.price||0)}</small>
              </div>
            `).join("")}
            <div class="kv kvLine"><span>Subtotal</span><strong>~$${formatInt(subtotal(detail))} AUD</strong></div>
            <div class="kv"><span>Estimated draw</span><strong style="color:${getCSS("--c-power")}">~${detail.watts||0}W</strong></div>
          </div>
        </div>

        ${detail.link ? `<div style="margin-top: 10px; font-size:10px; color:#444;">Ref: ${escapeHtml(detail.link)}</div>` : ``}
      `;
    }

    function resolveDetail(selectionId){
      // rack item
      if (selectionId.startsWith("rack:")){
        const idx = parseInt(selectionId.split(":")[1], 10);
        return RACK_ITEMS[idx];
      }
      // port tile: map to an item by name, but show port context in description/notes
      if (selectionId.startsWith("port:")){
        const i = parseInt(selectionId.split(":")[1], 10);
        const p = SWITCH_PORTS[i];
        // find referenced rack item
        const item = RACK_ITEMS.find(x => x.name === p.refName) || RACK_ITEMS.find(x => x.name.includes("CRS310")) || null;
        if (!item) return null;

        // clone + enrich
        return {
          ...item,
          name: `Switch ${p.port} ‚Äî ${p.device}`,
          uLabel: "Port assignment",
          description: `Port ${p.port} assignment: ${p.device}.`,
          notes: `VLAN intent: ${p.vlan}. Use this mapping as your ‚Äúdefault patch plan‚Äù. If you change VLAN membership, update this table + your RouterOS/pfSense config accordingly.`,
          price: item.price || 0,
          watts: 0,
          extras: []
        };
      }
      return null;
    }

    // ========= INTERACTION =========
    function wireTabs(){
      document.querySelectorAll(".tabBtn").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const next = btn.dataset.tab;
          setTab(next);
        });
      });
    }

    function setTab(tab){
      activeTab = tab;

      // button state
      document.querySelectorAll(".tabBtn").forEach(b=>{
        b.classList.toggle("active", b.dataset.tab === tab);
      });

      // panels
      document.getElementById("tab-rack").style.display = tab === "rack" ? "block" : "none";
      document.getElementById("tab-vlans").style.display = tab === "vlans" ? "block" : "none";
      document.getElementById("tab-ports").style.display = tab === "ports" ? "block" : "none";
      document.getElementById("tab-changes").style.display = tab === "changes" ? "block" : "none";
    }

    function select(id){
      selectedId = (selectedId === id) ? null : id;

      // re-render selection visuals in rack + external
      renderRack();

      // selection visuals for ports tab
      document.querySelectorAll(".port").forEach(p=>{
        p.style.outline = "";
        p.style.boxShadow = "";
        if (p.dataset.id === selectedId){
          p.style.outline = "1px solid rgba(255,255,255,.12)";
          p.style.boxShadow = "0 0 0 1px rgba(255,255,255,.06) inset";
        }
      });

      showDetail(selectedId);
    }

    function isSelected(id){ return selectedId === id; }

    // ========= HELPERS =========
    function subtotal(item){
      const base = item.price || 0;
      const extras = (item.extras||[]).reduce((s,e)=>s+(e.price||0),0);
      return base + extras;
    }
    function formatInt(n){
      const x = Math.round(Number(n)||0);
      return x.toLocaleString("en-AU");
    }
    function round1(n){
      return Math.round(n*10)/10;
    }
    function escapeHtml(s){
      return String(s ?? "").replace(/[&<>"']/g, (m)=>({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
      }[m]));
    }
    function getCSS(varName){
      return getComputedStyle(document.documentElement).getPropertyValue(varName).trim();
    }
    function hexA(hex, a){
      // supports #rgb or #rrggbb
      let h = (hex||"").trim();
      if (!h.startsWith("#")) return `rgba(255,255,255,${a})`;
      if (h.length === 4){
        h = "#" + h[1]+h[1] + h[2]+h[2] + h[3]+h[3];
      }
      const r = parseInt(h.slice(1,3),16);
      const g = parseInt(h.slice(3,5),16);
      const b = parseInt(h.slice(5,7),16);
      return `rgba(${r},${g},${b},${a})`;
    }
  </script>
</body>
</html>
